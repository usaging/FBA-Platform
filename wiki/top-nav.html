<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FBA-PLATFORM</title>
</head>

<body>
<!-- 顶部导航栏 -->
<nav class="top-nav">
    <div class="nav-container">
        <!-- Logo和标题 -->
        <div class="image-text">
            <span class="image"><img src="{{url_for('static',filename='icons/logo.svg')}}" alt=""></span>
            <div class="text logo-text">
                <span class="name">FBA-PLATFORM</span> 
                <span class="software">SCUT-CHINA_L</span>
            </div>
        </div>
        
        <!-- 模型显示区域 -->
        <div class="selected-model" id="selectedModel">
            <i class="fa-solid fa-database"></i>
            <span id="modelIdText">未选择模型</span>
        </div>

        <!-- 操作按钮区域 -->
        <div class="action-buttons">
            <button class="prev-btn hidden" id="prevBtn">
                <i class="iconfont icon-arrow-left"></i> 上一步
            </button>
            <button class="next-btn" id="nextBtn">
                下一步 <i class="iconfont icon-arrow-right"></i>
            </button>
        </div>
    </div>
</nav>

<script>
    document.getElementById('importBtn').addEventListener('click', () => {
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', async (e) => {
        const files = e.target.files;
        if (files.length === 0) return;

        const formData = new FormData();
        for (const file of files) {
            formData.append('files', file);
        }

        try {
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            alert(result.message);
        } catch (error) {
            alert('上传失败，请检查网络连接');
        }
    });
</script>

<script>
    // 下一步跳转功能
    document.addEventListener('DOMContentLoaded', () => {
        const currentPath = window.location.pathname;
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const modelIdText = document.getElementById('modelIdText');

        // 从本地存储获取选中的模型ID
        const selectedModelId = localStorage.getItem('selectedModelId');
        if (selectedModelId) {
            modelIdText.textContent = selectedModelId;
        }

        // 只在首页隐藏上一步按钮
        if (currentPath === '/') {
            prevBtn.classList.add('hidden');
        } else {
            prevBtn.classList.remove('hidden');
        }
        
        // 设置按钮状态
        if (currentPath.includes('/analysis')) {
            nextBtn.textContent = '计算结果';
        } else {
            nextBtn.textContent = '下一步';
        }
        
        // 下一步按钮点击事件
        nextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            
            // 检查是否在模型选择页面且未选择模型
            if (currentPath === '/model' && !selectedModelId) {
                alert('请先选择一个模型');
                return;
            }
            
            const routes = {
                '/': '/model',
                '/model': '/objective',
                '/objective': '/constraints',
                '/constraints': '/gene',
                '/gene': '/confirm',
                '/confirm': '/result'
            };
            
            const nextRoute = routes[currentPath] || '/model';
            window.location.href = nextRoute;
        });
        
        // 上一步按钮点击事件
        prevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            
            const routes = {
                '/model': '/',
                '/objective': '/model',
                '/constraints': '/objective',
                '/gene': '/constraints',
                '/confirm': '/gene',
                '/result':'/confirm'
            };
            
            const prevRoute = routes[currentPath] || '/model';
            window.location.href = prevRoute;
        });
    });
</script>

</body>
</html>